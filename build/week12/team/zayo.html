<html>
<head>
    <style>
        .answer {
            min-height: 50px
        }
        section{
          padding: 10px;
          margin-bottom: 12px
        }
        .parallax-container {
          height: 300
        }
        .popup {
            width: 500;
            height: 500;
        }
        #title {
          position: absolute;
          padding: 20px;
          font-size: 64px;
          font-weight: bolder;
          color: white;
          top: 100px;
          left: 0px;
          text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black
        }
        #title .authors {
          padding: 20px;
          font-size: 32px;
          font-weight: bolder;
          color: #BBB;
          text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black
        }
        #map { height: 1000px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
</head>
<body>

  <div class="parallax-container">
    <div class="parallax">
      <img src="sepp.jpg">
      <h1 id="title">What is the (1) number of accounts; and (2) combined MRR for each Zayo customer? 
        <div class="authors">[Kevin Gifford](http://github.com/kevinkgifford)
        </div>
      </h1>
    </div>
  </div>

  <div class="section white container flow-text">

      <div id="questions" class="collection with-header">
          <div class="collection-header">Questions</div>
          <section id="q1" class="question collection-item">
              <h4>Q1: What is the (1) number of accounts; and (2) combined MRR for each Zayo customer? (contributed by Kevin Gifford) <b></h4>
              <div class="answer"></div>
          </section>
  </div>

  <div class="parallax-container" style="height:200px">
    <div class="parallax">
      <img src="sepp.jpg">
    </div>
  </div>


  <div class="section white container flow-text">
    <div class="markdown">

# Discussion


    </div>
  </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
    <script src="http://bigdatahci2015.github.io/data/js/geolib.js"></script>
    <script>

var items   // global scope (i.e., can be accessed in javascript console)

function solution1() {

  var groups = _.groupBy(items, 'ID/Name')
  var lengths = _.mapValues(groups, function(d) {
    return d.length
  })
  var pairs = _.pairs(lengths)
  var sorted_output = _.sortBy(pairs, function(d) {
    return -d[1]
  })

  var mrrSum = _.mapValues(groups, function(d) {
    return _.round(_.sum(_.pluck(d, 'Total MRR')), 0)
  })
  var pairs = _.pairs(mrrSum)
  var sorted_mrrSum = _.sortBy(pairs, function(d) {
    return -d[1]
  })

  return '\nCustomer ID accounts: ' + sorted_output.join('; ') + 
         '\n          Customer ID MRR: ' + sorted_mrrSum.join('; ')
}

function run(id, solutionFunc, data){
    console.log('run solution for ' + id)
    var answer = solutionFunc(data)
    $(id).find('.answer').html(answer)
}

function loadDataThenRunSolutions(){
  // map = L.map('map').setView([27, 85], 6)
  // L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  //     attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a       href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
  //     maxZoom: 18,
  //     id: 'doubleshow.noeko77m',
  //     accessToken: 'pk.eyJ1IjoiZG91Ymxlc2hvdyIsImEiOiJjaWZ5Y3B1eTE1MHRidWRtMG9uZXluajg4In0.u5ONW27Ly5cU7M5KYi6Y9Q'
  // }).addTo(map)
  // map.touchZoom.disable()
  // map.doubleClickZoom.disable()
  // map.scrollWheelZoom.disable()

  // $.get('http://bigdatahci2015.github.io/data/twitter/nepal_local_tweets.json')
  //   .done(function(data){

  $.get('services.json')
    .done(function(data){

        items = data
        console.log('number of items loaded:', items.length)
        console.log('first item', items[0])

       run('#q1', solution1, items)
     })
     .fail(function(err){
         console.error(err)
     })
}

loadDataThenRunSolutions()

// convert Markdown to html
$('.markdown').each(function(){
  var markdownText = $(this).text()
  $(this).html(marked(markdownText))
})

// initialize the parallax effect
$(document).ready(function(){
  console.log($('.parallax').html())
    $('.parallax').parallax()
})

    </script>

</body>
</html>
